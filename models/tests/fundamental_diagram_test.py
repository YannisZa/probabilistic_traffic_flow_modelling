import os, sys
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

import pytest
import numpy as np
from fundamental_diagrams import FundamentalDiagram
from fundamental_diagrams.exponential_fundamental_diagram import ExponentialFD

# Instantiate FDs
fd = FundamentalDiagram('exponential')
efd = ExponentialFD()


def test_rho_properties():
    rho = np.linspace(0.01,1,100)

    # Set rho
    efd.rho = rho
    # Assert that rho attribute was correctly stored
    assert (efd.rho == rho).all()

    # Delete rho
    del efd.rho
    # Assert that rho attribute does not exist
    assert not hasattr(efd, 'rho')

    # Set rho for next tests
    efd.rho = rho



def test_q_simulation():
    p = [0.6,0.1]

    # Simulate data
    efd.simulate(p)

    # Expected q
    q_true = [0.005994002999000251, 0.011976023984007997, 0.017946080919060713, 0.023904191744255798, 0.029850374375780468, 0.035784646705941676, 0.04170702660319587, 0.04761753191217891, 0.05351618045373572, 0.05940299002495008, 0.06527797839917433, 0.07114116332605899, 0.07699256253158243, 0.0828321937180804, 0.08866007456427565, 0.09447622272530737, 0.10028065583276079, 0.1060733914946965, 0.11185444729567988, 0.11762384079681062, 0.1233815895357519, 0.12912771102675974, 0.13486222276071225, 0.14058514220513896, 0.1462964868042499, 0.1519962739789649, 0.15768452112694256, 0.16336124562260948, 0.16902646481718925, 0.17468019603873147, 0.18032245659214083, 0.18595326375920596, 0.19157263479862835, 0.19718058694605137, 0.20277713741408898, 0.20836230339235462, 0.2139361020474899, 0.21949855052319348, 0.2250496659402498, 0.23058946539655756, 0.23611796596715853, 0.2416351847042661, 0.24714113863729392, 0.2526358447728843, 0.258119320094937, 0.26359158156463725, 0.2690526461204847, 0.2745025306783214, 0.2799412521313604, 0.2853688273502142, 0.29078527318292263, 0.2961906064549815, 0.30158484396937085, 0.3069680025065827, 0.3123400988246497, 0.3177011496591732, 0.323051171723351, 0.32839018170800593, 0.3337181962816133, 0.33903523209032954, 0.3443413057580195, 0.34963643388628507, 0.35492063305449234, 0.36019391981980015, 0.36545631071718737, 0.37070782225948107, 0.3759484709373842, 0.38117827321950315, 0.38639724555237565, 0.3916054043604983, 0.3968027660463543, 0.40198934699044087, 0.4071651635512972, 0.41233023206553154, 0.41748456884784874, 0.4226281901910783, 0.4277611123662008, 0.43288335162237634, 0.4379949241869711, 0.4430958462655851, 0.4481861340420795, 0.4532658036786035, 0.45833487131562206, 0.46339335307194285, 0.46844126504474326, 0.4734786233095979, 0.4785054439205055, 0.48352174290991595, 0.4885275362887574, 0.49352284004646324, 0.4985076701509991, 0.50348204254889, 0.5084459731652464, 0.5133994779037926, 0.518342572646892, 0.5232752732555748, 0.5281975955695647, 0.5331095554073054, 0.5380111685659877, 0.5429024508215757]

    # Make sure you simulation is the following
    assert (efd.q == q_true).all()
